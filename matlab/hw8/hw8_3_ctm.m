% 20190348 Jungill Kang
addpath('..\mr')

clear;
clc;

%% Robot properties
% mass (kg)
m = [11.80; 8.00; 3.00; 2.12; 2.29; 0.40];

% Moment of inertia (kg*m^2)
I1 = zeros(3,3); I1(1,1)=0.1542; I1(2,2)=0.1294; I1(3,3)=0.0600;
I2 = zeros(3,3); I2(1,1)=0.2936; I2(2,2)=0.2809; I2(3,3)=0.0362;
I3 = zeros(3,3); I3(1,1)=0.0342; I3(2,2)=0.0341; I3(3,3)=0.0045;
I4 = zeros(3,3); I4(1,1)=0.0067; I4(2,2)=0.0028; I4(3,3)=0.0062;
I5 = zeros(3,3); I5(1,1)=0.0099; I5(2,2)=0.0098; I5(3,3)=0.0027;
I6 = zeros(3,3); I6(1,1)=0.0004; I6(2,2)=0.0004; I6(3,3)=0.0006;
Ilist = cat(3, I1, I2, I3, I4, I5, I6);

% length
L1 = 449.5 * 0.001;
L2 = 265.5 * 0.001;
L3 = 228 * 0.001;
H1 = 223 * 0.001;
H2 = 84.5 * 0.001;
W1 = 109.3 * 0.001;
W2 = 31.1 * 0.001;
W3 = 74.2 * 0.001;
W4 = 114.3 * 0.001;
W5 = 68.7 * 0.001;
q1 = 111.5 * 0.001;
q2 = 70 * 0.001;
q3 = 220 * 0.001;
q4 = 150 * 0.001;
q5 = 192 * 0.001;
q6 = 210 * 0.001;

% thetalist
thetalist = [0; 0; 0; 0; 0; 0];
dthetalist = [0.2; 0.2; 0.2; 0.2; 0.2; 0.2];

% gravity
g = [0; 0; -9.8];

% M list at all theta = 0
M01 = [
    0 1 0 0;
    -1 0 0 0;
    0 0 1 q1;
    0 0 0 1];
M12 = [
    1 0 0 0;
    0 1 0 -W1-q2;
    0 0 1 -q1+H1+q3;
    0 0 0 1];
M23 = [
    1 0 0 0;
    0 1 0 q2+W2+W3;
    0 0 1 -q3+L1+q4;
    0 0 0 1];
M34 = [
    1 0 0 0;
    0 1 0 0;
    0 0 1 -q4+L2+H2;
    0 0 0 1];
M45 = [
    1 0 0 0;
    0 1 0 -W4-W5;
    0 0 1 0;
    0 0 0 1;];
M56 = [
    1 0 0 0;
    0 1 0 0;
    0 0 1 q6;
    0 0 0 1];
M67 = [
    0 -1 0 0;
    1 0 0 0;
    0 0 1 -q6+L3;
    0 0 0 1];

Mlist = cat(3, M01, M12, M23, M34, M45, M56, M67);

% G list, spatial inertia matrix
G1 = diag([I1(1,1), I1(2,2), I1(3,3), m(1), m(1), m(1)]);
G2 = diag([I2(1,1), I2(2,2), I2(3,3), m(2), m(2), m(2)]);
G3 = diag([I3(1,1), I3(2,2), I3(3,3), m(3), m(3), m(3)]);
G4 = diag([I4(1,1), I4(2,2), I4(3,3), m(4), m(4), m(4)]);
G5 = diag([I5(1,1), I5(2,2), I5(3,3), m(5), m(5), m(5)]);
G6 = diag([I6(1,1), I6(2,2), I6(3,3), m(6), m(6), m(6)]);
Glist = cat(3, G1, G2, G3, G4, G5, G6);

% S list, screw axis list
Slist = [[0 ; 0; 1; 0; 0; 0;], ...
        [-1; 0; 0; 0; -H1; 0;], ...
        [-1; 0; 0; 0; -L1-H1; 0;], ...
        [0 ; 0; 1; 0; W1-W2-W3; 0;], ...
        [-1 ; 0; 0; 0; -H1-H2-L1-L2; 0;], ...
        [0 ; 0; 1; 0; W1-W2-W3+W4+W5; 0;]];

eint = [0;0;0;0;0;0];

thetalistd = [0; -90*pi/180; -30*pi/180; 0; -55*pi/180; 0];
dthetalistd = [0.3; 0.3; 0.3; 0.3; 0.3; 0.3];
ddthetalistd = [0.1; 0.1; 0.1; 0.1; 0.1; 0.1];

Kp = 1.3;
Ki = 1.2;
Kd = 1.1;

taulist  = ComputedTorque(thetalist, dthetalist, eint, g, Mlist, Glist, Slist, ...
    thetalistd, dthetalistd, ddthetalistd, Kp, Ki, Kd);